# 更新日志

本项目的所有重要变更都将记录在此文件中。

---

## v2.4

### ✨ 新增功能

#### UI 与交互增强
- 新增部分设置选项（字体大小、行高、圆点对齐、字体来源等）
- 支持 `Ctrl+滚轮` 快速调整字体大小（10-30px）
- 圆点大小跟随字体大小自动调整
- 圆点垂直中心始终与第一行文本的垂直中心对齐
- 字体大小修改后，Live Preview 模式渲染层保持与编辑层一致
- 折叠指示器修改为 SVG 方案

#### Thino 兼容模式
- 新增 Thino/Memos 插件兼容模式
- **启用 Thino 兼容模式后**：
  - 第 1 级列表项的续行内容保留原始缩进格式（Tab 或空格）
  - 第 2~n 级列表项的续行保持标准两个空格格式
  - Markdown ↔ 大纲视图切换时保持原始缩进不变
  - 新建节点自动添加时间戳功能（可选，支持 `HH:mm` 或 `HH:mm:ss`）
  - 新增快捷键命令：`Workflowy: 切换新建节点自动添加时间戳`
- **关闭 Thino 兼容模式时**：
  - 自动将 Tab 转为空格，续行统一为两个空格格式

### 🐛 修复
- 实时预览模式下单节点续行内容的有序/无序列表渲染层显示问题
- 续行内容字符串两端的空白字符未正常保留
- Thino 兼容开关未生效的问题
- 续行检测的正则表达式将以数字开头的行误判为列表项

### 🔧 改进

#### 联动与兼容性
- 优化与 Thino、TickTickSync 插件的兼容性
- 改进续行缩进类型的检测与还原机制

#### 内存管理优化
- 新增组件销毁机制，防止内存泄漏
- 为 `ZoomManager`、`ThemeManager`、`FileDropHandler` 添加 `destroy()` 方法
- 增强 `TagSuggestMenu`、`SlashCommandMenu` 的资源清理
- 新增 `OutlineItem.cleanupStaticResources()` 静态方法，清理拖拽相关资源

#### 生命周期管理
- 增强 `WorkflowyView.onClose()` 级联销毁所有子组件
- 添加 `isClosing` 标志防止视图关闭后继续异步操作
- 添加 `wheelHandler` 事件追踪，确保正确移除事件监听器

#### 防御性编程
- 为 `VerticalLinesManager`、`MultiSelectionManager` 添加 `isDestroyed` 检查
- 在异步操作完成后检查组件状态，避免更新已销毁视图
- 增强插件 `onunload()` 清理静态资源

---

## v2.3

### ✨ 新增功能
- `/` 打开斜杠命令菜单，迁移 obsidian-tasks 插件编辑任务功能（兼容 TickTickSync）

| 命令类型 | 功能 |
|----------|------|
| **时间** | 设置任务时间 `[HH:MM]`，支持时间范围 |
| **优先级** | 🔺最高 / ⏫高 / 🔼中 / 🔽低 / ⏬最低 |
| **日期** | 📅截止日期 / ⏳计划日期 / 🛫开始日期 / ➕创建日期 / ✅完成日期 |
| **状态** | ☐待办 / ◐进行中 / ☑已完成 / ⊘已取消 / •普通项目 |

- 添加时间选择器、日期选择器
- 分组显示斜杠命令，带有分组标题
- 使用 title 属性为斜杠命令菜单添加中文悬浮提示
- 命令重复输入时自动替换而非追加
- `#` 打开标签建议菜单，实时过滤并快速插入
- 菜单键盘导航支持：↑/↓ 导航，Enter 选择，Escape 关闭

### 🐛 修复
- `/` 命令导致的光标位置问题
- 菜单键盘导航失效问题
- 状态命令修改底层 Markdown 时触发的 `Uncaught TypeError` 错误
- 节点换行中的空行在切换回 Markdown 视图时丢失的问题
- Live Preview 模式渲染层 Markdown 元素（标题、代码块等）的换行逻辑优化
- 斜杠命令和标签建议菜单未跟随输入光标位置的问题

---

## v2.2

### 🔧 改进
- 有序列表自动排序
- 大纲视图下编辑的有序列表与 Markdown 视图双向同步

### 🐛 修复
- 有序列表自动被修改为无序列表的问题
- 有序列表与节点内容间距过大的问题
- `Ctrl+Z` 或跨文档拖拽导致的有序列表序号丢失问题

---

## v2.1

### ✨ 新增功能
- 移动端工具栏按钮：待办、加粗、斜体、删除线、高亮、代码、缩进控制、回车、收键盘
- 重新设计移动端折叠指示器（放至右侧，展开 ▼，折叠 ◀）

### 🐛 修复
- 移动端圆圈节点样式过大的问题（改用 `::after` 伪元素）
- 移动端节点折叠后中心显示矩形方框的问题
- 移动端垂直线未对齐圆圈中心的问题
- 三角形折叠指示器位置错位问题

---

## v2.0

### ✨ 新增功能
- 类 Logseq 快捷键及功能：`Shift+点击`、`Ctrl+悬浮`、`Alt+创建块引用`
- 块跨文档单选与多选拖拽功能（通过节点圆圈）
- 跨/本文档 `Alt+拖拽` 自动创建块引用
- 前缀为 `!` 的标题/块引用双链跳转及高亮显示

### 🐛 修复
- 删除当前块（`Ctrl+Shift+Backspace`）后的光标定位问题

---

## v1.9

### ✨ 新增功能
- 支持从剪贴板粘贴图片或从文件列表拖拽图片至视图
- 支持拖拽文件生成链接（.md 为双链，其他为嵌入链接）
- Live Preview 及源码模式拖拽文件增加光标指示
- 标题引用、块引用的双链跳转及高亮效果

### 🐛 修复
- 将"删除当前块"、"向上/下移动块"快捷键改为内置
- 补充快捷键：清空当前节点内容（`Ctrl+Backspace`）

---

## v1.8

### ✨ 新增功能
- 保存节点折叠/展开状态至 Markdown（使用 `<!--c-->` 标记）
- Live Preview 模式编辑层隐藏块引用 ID，防止误编辑

### 🐛 修复
- 块引用 ID 与折叠标记冲突的问题
- Live Preview 块引用链接格式修正（补全 `#` 后的空格）
- `Shift+Enter` 换行内容导致折叠标记解析错误的问题

---

## v1.7

### ✨ 新增功能
- 为空 Workflowy 视图添加新增节点提示
- 支持多分屏下同文件的双向实时更新（兼容 Mindmap NextGen）
- 增加切换渲染模式（源码/Live Preview）的快捷命令

### 🐛 修复
- Live Preview 编辑模式下方向键导航失效的问题
- 移除冗余的快捷键命令配置，减少冲突

---

## v1.6

### 🔧 改进
- 异步嵌入内容（图片、Dataview、Excalidraw 等）复用 DOM 元素，避免闪烁
- 嵌入内容增加跳转图标按钮，支持 Excalidraw 图片双击
- 使用 `AbstractInputSuggest` 实现双链、标签及块引用的输入建议
- 优化拖拽逻辑，区分文本选择与块拖拽

### 🐛 修复
- 嵌入内容导致的后续节点垂直线渲染错误
- 代码块缩进丢失问题
- 窗口缩放或边栏变动时自动重绘垂直线

---

## v1.5

### 🐛 修复
- 标签点击搜索及图片渲染问题
- 嵌入内容点击跳转及图标显示
- 嵌入内容适配各类主题样式

---

## v1.4

### 🐛 修复
- 子节点缩进随动逻辑
- 多选节点缩进逻辑
- 缩进（Tab/Shift+Tab）逻辑错误
- 源码/Live Preview 模式下 Enter 键导致的闪烁问题
- 限制显示层拖拽选取多选节点，避免编辑层干扰
- 编辑节点时光标/视口跳动问题
- 操作节点时的 Console 报错
- 优化撤销（Undo）底线，避免进入空状态

---

## v1.3

### 🐛 修复
- Live Preview 模式下 Backspace 无法删除空节点的问题
- 拖拽节点后垂直线渲染不正确的问题
- 内存泄漏及性能优化

---

## v1.2

### ✨ 新增功能
- 实时预览模式（Live Preview，类似 Logseq）
- 渲染模式配置选项（源码模式 / 实时预览模式）

---

## v1.1

### ✨ 新增功能
- 支持非列表项（非 `- ` 开头）的只读 Markdown 渲染
- 支持双链面板跳转及前进/返回导航

---

## v1.0

### 🎉 首次发布

**大纲视图功能：**
- 顶部导航栏，支持节点导航和搜索（12 款内置主题）
- 4 个空格为一个 Tab 缩进，`- ` 开头格式（类似 Logseq）

**点击操作：**
- 点击左侧垂直线可折叠/展开节点
- 点击圆圈进入缩放聚焦模式
- 按住鼠标左键上下拖拽多选节点，Ctrl+点击选择不连续节点

**快捷键：**
- `Enter` - 创建新节点
- `Tab` / `Shift+Tab` - 增加/减少缩进
- `Ctrl+Enter` - 切换待办状态（再按一次完成，子节点变灰）
- `Ctrl+Shift+↑/↓` - 上下移动节点
- `Alt+↑/↓` - 缩放导航
- `Shift+Enter` - 节点内换行
- `Ctrl+Backspace` - 清空节点内容
- `Ctrl+Shift+Backspace` - 删除当前节点
